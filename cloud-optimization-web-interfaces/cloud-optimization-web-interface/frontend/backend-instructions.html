<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backend API Documentation - COA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.1);
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }

        .nav-tabs {
            background: #f8f9fa;
            padding: 0;
            display: flex;
            border-bottom: 2px solid #e9ecef;
            overflow-x: auto;
        }

        .nav-tab {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
        }

        .nav-tab:hover {
            background: #e9ecef;
            color: #495057;
        }

        .nav-tab.active {
            color: #2c3e50;
            border-bottom-color: #2c3e50;
            background: white;
        }

        .content {
            padding: 40px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            margin-bottom: 50px;
        }

        .section h2 {
            color: #2c3e50;
            font-size: 2rem;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .section h3 {
            color: #34495e;
            font-size: 1.5rem;
            margin: 30px 0 15px 0;
        }

        .section h4 {
            color: #2c3e50;
            font-size: 1.2rem;
            margin: 20px 0 10px 0;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .feature-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            border-left: 5px solid #3498db;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .feature-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .feature-card p {
            color: #6c757d;
            margin-bottom: 15px;
        }

        .feature-list {
            list-style: none;
            padding: 0;
        }

        .feature-list li {
            padding: 5px 0;
            color: #495057;
        }

        .feature-list li::before {
            content: "‚úì";
            color: #27ae60;
            font-weight: bold;
            margin-right: 10px;
        }

        .endpoint {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .endpoint-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .method {
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 12px;
            text-transform: uppercase;
        }

        .method.get {
            background: #d4edda;
            color: #155724;
        }

        .method.post {
            background: #cce5ff;
            color: #004085;
        }

        .method.put {
            background: #fff3cd;
            color: #856404;
        }

        .method.delete {
            background: #f8d7da;
            color: #721c24;
        }

        .endpoint-path {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 16px;
            font-weight: 500;
            color: #2c3e50;
        }

        .endpoint-body {
            padding: 20px;
        }

        .endpoint-description {
            margin-bottom: 20px;
            color: #495057;
        }

        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
        }

        .json {
            background: #2d3748;
            color: #e2e8f0;
        }

        .bash {
            background: #1a202c;
            color: #68d391;
        }

        .parameters {
            margin: 20px 0;
        }

        .parameter {
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 0 6px 6px 0;
        }

        .parameter-name {
            font-weight: bold;
            color: #2c3e50;
        }

        .parameter-type {
            color: #e74c3c;
            font-family: monospace;
            font-size: 12px;
        }

        .parameter-required {
            background: #e74c3c;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            margin-left: 10px;
        }

        .parameter-optional {
            background: #95a5a6;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            margin-left: 10px;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 30px;
            color: #3498db;
            text-decoration: none;
            font-weight: 500;
            padding: 10px 20px;
            border: 2px solid #3498db;
            border-radius: 25px;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
        }

        .toc {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 30px 0;
        }

        .toc h3 {
            margin-top: 0;
            color: #2c3e50;
        }

        .toc ul {
            list-style: none;
            padding-left: 0;
        }

        .toc li {
            padding: 5px 0;
        }

        .toc a {
            color: #3498db;
            text-decoration: none;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-stable {
            background: #d4edda;
            color: #155724;
        }

        .status-beta {
            background: #fff3cd;
            color: #856404;
        }

        .status-new {
            background: #cce5ff;
            color: #004085;
        }

        .architecture-diagram {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .content {
                padding: 20px;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .endpoint-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Backend API Documentation</h1>
            <p>Comprehensive guide to the Cloud Optimization Assistant backend service featuring AI-powered AWS
                analysis, agent management, and real-time chat capabilities.</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('overview')">üìã Overview</button>
            <button class="nav-tab" onclick="showTab('features')">‚ö° Features</button>
            <button class="nav-tab" onclick="showTab('chat-api')">üí¨ Chat API</button>
            <button class="nav-tab" onclick="showTab('agent-api')">ü§ñ Agent API</button>
            <button class="nav-tab" onclick="showTab('config-api')">‚öôÔ∏è Config API</button>
            <button class="nav-tab" onclick="showTab('agentcore-api')">üîß AgentCore API</button>
            <button class="nav-tab" onclick="showTab('cross-account')">üîó Cross-Account Operations</button>
            <button class="nav-tab" onclick="showTab('examples')">üìù Examples</button>
        </div>

        <div class="content">
            <a href="index.html" class="back-link">‚Üê Back to Chat Interface</a>

            <!-- Overview Tab -->
            <div id="overview" class="tab-content active">
                <div class="section">
                    <h2>üéØ Service Overview</h2>
                    <p>The Cloud Optimization Assistant (COA) backend is a comprehensive FastAPI-based service that
                        provides AI-powered AWS cloud optimization and security analysis. It integrates multiple AWS
                        services including Amazon Bedrock, AgentCore Runtime, and various MCP (Model Context Protocol)
                        servers to deliver intelligent insights and recommendations.</p>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">40+</div>
                            <div class="stat-label">API Endpoints</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">8</div>
                            <div class="stat-label">Core Services</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">3</div>
                            <div class="stat-label">Agent Types</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">100%</div>
                            <div class="stat-label">AWS Native</div>
                        </div>
                    </div>

                    <h3>üèóÔ∏è Architecture</h3>
                    <div class="architecture-diagram">
                        <pre style="text-align: left; font-family: monospace; color: #2c3e50;">
                            
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend      ‚îÇ    ‚îÇ  FastAPI Backend  ‚îÇ    ‚îÇ  AWS Services           ‚îÇ
‚îÇ   (React/HTML)  ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ  (Python)         ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ (Bedrock Model/SSM/etc) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                       ‚îÇ
        ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ prompt-templates ‚îÇ   ‚îÇ AgentCore Runtime ‚îÇ
‚îÇ  ‚Ä¢ Security      ‚îÇ   ‚îÇ (Strands)         ‚îÇ
‚îÇ  ‚Ä¢ Cost Optimize ‚îÇ   ‚îÇ  ‚Ä¢ AWS-API-MCP    ‚îÇ
‚îÇ  ‚Ä¢ .... others.  ‚îÇ   ‚îÇ  ‚Ä¢ AWS-WA-Sec-MCP ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò


                        </pre>
                    </div>

                    <div class="feature-card" style="margin: 30px 0; background: #e8f5e8; border-left: 5px solid #27ae60;">
                        <h4>üöÄ Easy Platform Extension</h4>
                        <p><strong>Extend functionality effortlessly by creating new prompt templates!</strong> Simply create new prompt files and upload them to the <code>prompt-templates</code> folder in your S3 bucket. With proper descriptions, the AI agents will automatically leverage MCP server capabilities to interact with AWS environments and retrieve real data for your specific use cases.</p>
                        <ul class="feature-list">
                            <li>Create custom assessment workflows</li>
                            <li>Add domain-specific analysis templates</li>
                            <li>Leverage existing MCP tools for new scenarios</li>
                            <li>No code changes required - just upload and use</li>
                        </ul>
                    </div>

                    <h3>üîë Key Capabilities</h3>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>ü§ñ Multi-Agent Orchestration</h4>
                            <p>Intelligent routing between Bedrock Agents, AgentCore Runtime, and Strands Agents based
                                on query context and capabilities.</p>
                        </div>
                        <div class="feature-card">
                            <h4>üí¨ Real-time Chat</h4>
                            <p>WebSocket-based chat interface with streaming responses, tool execution tracking, and
                                session management.</p>
                        </div>
                        <div class="feature-card">
                            <h4>üîß Agent Management</h4>
                            <p>Complete lifecycle management including registration, discovery, health monitoring, and
                                safe unregistration.</p>
                        </div>
                        <div class="feature-card">
                            <h4>‚öôÔ∏è Configuration Management</h4>
                            <p>Dynamic configuration via AWS SSM Parameter Store with real-time updates and validation.
                            </p>
                        </div>
                        <div class="feature-card">
                            <h4>üîê Security & Auth</h4>
                            <p>Amazon Cognito integration with JWT tokens, role-based access, and secure API endpoints.
                            </p>
                        </div>
                        <div class="feature-card">
                            <h4>üìä Monitoring & Health</h4>
                            <p>Comprehensive health checks, metrics collection, and detailed logging for all services.
                            </p>
                        </div>
                    </div>

                    <h3>üõ†Ô∏è Technology Stack</h3>
                    <ul class="feature-list">
                        <li><strong>Framework:</strong> FastAPI with async/await support</li>
                        <li><strong>AI/ML:</strong> Amazon Bedrock (Claude 3.5 Sonnet, Claude 3 Haiku)</li>
                        <li><strong>Agent Runtime:</strong> Amazon Bedrock AgentCore</li>
                        <li><strong>Configuration:</strong> AWS Systems Manager Parameter Store</li>
                        <li><strong>Authentication:</strong> Amazon Cognito User Pools</li>
                        <li><strong>Real-time:</strong> WebSocket connections</li>
                        <li><strong>Validation:</strong> Pydantic models</li>
                        <li><strong>Logging:</strong> Structured logging with correlation IDs</li>
                    </ul>
                </div>
            </div>

            <!-- Features Tab -->
            <div id="features" class="tab-content">
                <div class="section">
                    <h2>‚ö° Core Features</h2>

                    <h3>ü§ñ Agent Orchestration</h3>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>Intelligent Routing <span class="status-badge status-stable">Stable</span></h4>
                            <p>Automatically routes queries to the most appropriate agent based on:</p>
                            <ul class="feature-list">
                                <li>Keyword analysis and intent detection</li>
                                <li>Agent capabilities and domain expertise</li>
                                <li>Agent health and availability status</li>
                                <li>Cross-domain analysis requirements</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <h4>Multi-Runtime Support <span class="status-badge status-stable">Stable</span></h4>
                            <p>Supports multiple agent runtime environments:</p>
                            <ul class="feature-list">
                                <li>Amazon Bedrock Agent Service</li>
                                <li>Amazon Bedrock AgentCore Runtime</li>
                                <li>Strands Agent Framework</li>
                                <li>Legacy MCP Server Integration</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <h4>Dynamic Discovery <span class="status-badge status-stable">Stable</span></h4>
                            <p>Automatic agent discovery and registration:</p>
                            <ul class="feature-list">
                                <li>SSM Parameter Store scanning</li>
                                <li>Health check validation</li>
                                <li>Capability detection</li>
                                <li>Real-time status updates</li>
                            </ul>
                        </div>
                    </div>

                    <h3>üí¨ Chat & Communication</h3>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>WebSocket Chat <span class="status-badge status-stable">Stable</span></h4>
                            <p>Real-time bidirectional communication:</p>
                            <ul class="feature-list">
                                <li>Streaming responses</li>
                                <li>Typing indicators</li>
                                <li>Connection status monitoring</li>
                                <li>Session persistence</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <h4>REST API <span class="status-badge status-stable">Stable</span></h4>
                            <p>Comprehensive REST endpoints:</p>
                            <ul class="feature-list">
                                <li>Synchronous chat interactions</li>
                                <li>Session management</li>
                                <li>History retrieval</li>
                                <li>Tool execution tracking</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <h4>Enhanced Responses <span class="status-badge status-stable">Stable</span></h4>
                            <p>Rich response formatting:</p>
                            <ul class="feature-list">
                                <li>Markdown rendering</li>
                                <li>Structured data extraction</li>
                                <li>Human-readable summaries</li>
                                <li>Tool execution results</li>
                            </ul>
                        </div>
                    </div>

                    <h3>üîß Agent Management</h3>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>Lifecycle Management <span class="status-badge status-new">New</span></h4>
                            <p>Complete agent lifecycle control:</p>
                            <ul class="feature-list">
                                <li>Agent registration and discovery</li>
                                <li>Health monitoring and status tracking</li>
                                <li>Safe unregistration with dry-run</li>
                                <li>Bulk operations support</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <h4>Parameter Management <span class="status-badge status-new">New</span></h4>
                            <p>SSM parameter operations:</p>
                            <ul class="feature-list">
                                <li>Multi-prefix scanning</li>
                                <li>Orphaned parameter cleanup</li>
                                <li>Validation and integrity checks</li>
                                <li>Backup and restore capabilities</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <h4>Web Interface <span class="status-badge status-new">New</span></h4>
                            <p>User-friendly management interface:</p>
                            <ul class="feature-list">
                                <li>Visual agent listing and status</li>
                                <li>Interactive unregistration workflow</li>
                                <li>Real-time operation feedback</li>
                                <li>Bulk operation support</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Chat API Tab -->
            <div id="chat-api" class="tab-content">
                <div class="section">
                    <h2>üí¨ Chat API Endpoints</h2>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <span class="endpoint-path">/api/chat</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Send a chat message and receive an AI-powered response with tool execution tracking.
                            </div>
                            <h4>Request Body</h4>
                            <div class="code-block json">
                                {
                                "message": "I want to check my AWS security posture",
                                "session_id": "optional-session-id",
                                "context": {
                                "aws_account_id": "123456789012"
                                }
                                }
                            </div>
                            <h4>Response</h4>
                            <div class="code-block json">
                                {
                                "response": "I'll help you analyze your AWS security posture...",
                                "session_id": "web-session-1234567890",
                                "tool_executions": [
                                {
                                "tool_name": "CheckSecurityServices",
                                "tool_input": {...},
                                "tool_output": {...},
                                "status": "success",
                                "timestamp": "2024-01-01T12:00:00Z"
                                }
                                ],
                                "timestamp": "2024-01-01T12:00:00Z",
                                "structured_data": {...},
                                "human_summary": "Security analysis completed successfully"
                                }
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <span class="endpoint-path">/api/chat/enhanced</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Enhanced chat endpoint with dual runtime support (Bedrock Agent + AgentCore).
                            </div>
                            <h4>Request Body</h4>
                            <div class="code-block json">
                                {
                                "message": "Analyze my cost optimization opportunities",
                                "session_id": "enhanced-session-123",
                                "agent_type": "strands_aws_wa_sec_cost"
                                }
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <span class="endpoint-path">/api/chat/local</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Local testing endpoint without authentication requirements.
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/ws/{session_id}</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                WebSocket endpoint for real-time chat communication with streaming responses.
                            </div>
                            <h4>WebSocket Message Format</h4>
                            <div class="code-block json">
                                // Client to Server
                                {
                                "message": "What are my security findings?",
                                "context": {
                                "aws_account_id": "123456789012"
                                }
                                }

                                // Server to Client
                                {
                                "type": "chat_response",
                                "data": {
                                "response": "Here are your security findings...",
                                "tool_executions": [...],
                                "timestamp": "2024-01-01T12:00:00Z"
                                }
                                }
                            </div>
                        </div>
                    </div>

                    <h3>Session Management</h3>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/api/sessions/{session_id}/history</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Retrieve chat history for a specific session.
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <span class="endpoint-path">/api/session/{session_id}/initialize</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Initialize a session with tool discovery and agent capabilities.
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/api/session/{session_id}/info</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Get session information including available tools and agent context.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent API Tab -->
            <div id="agent-api" class="tab-content">
                <div class="section">
                    <h2>ü§ñ Agent Management API</h2>

                    <h3>Agent Discovery & Status</h3>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/api/agents/status</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Get basic agent status without authentication (for monitoring).
                            </div>
                            <h4>Response</h4>
                            <div class="code-block json">
                                {
                                "orchestrator_type": "strands_specialized",
                                "total_agents": 3,
                                "healthy_agents": 2,
                                "total_tools": 15,
                                "discovery_time": "2024-01-01T12:00:00Z",
                                "agents": {
                                "strands_aws_wa_sec_cost": {
                                "status": "HEALTHY",
                                "framework": "strands",
                                "capabilities_count": 8,
                                "has_endpoint": true
                                }
                                }
                                }
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/api/agents</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                List all available agents with detailed information.
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/api/agents/enhanced</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Get enhanced agent information from the dual runtime service.
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/api/agents/enhanced/runtime-types</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Get agents grouped by runtime type (Bedrock Agent vs AgentCore).
                            </div>
                        </div>
                    </div>

                    <h3>Agent Registration Management <span class="status-badge status-new">New</span></h3>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/api/agents/registered</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                List all registered agents across all SSM prefixes with detailed parameter information.
                            </div>
                            <h4>Response</h4>
                            <div class="code-block json">
                                {
                                "status": "success",
                                "agents": {
                                "strands_aws_wa_sec_cost": {
                                "agent_name": "strands_aws_wa_sec_cost",
                                "parameters": [
                                "/coa/agents/strands_aws_wa_sec_cost/agent_arn",
                                "/coa/agents/strands_aws_wa_sec_cost/metadata",
                                "/coa/agents/strands_aws_wa_sec_cost/endpoint_url"
                                ],
                                "prefixes": ["/coa/agents/"],
                                "metadata": {...},
                                "connection_info": {...}
                                }
                                },
                                "total_agents": 1,
                                "timestamp": "2024-01-01T12:00:00Z"
                                }
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/api/agents/{agent_name}/parameters</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Get all SSM parameters associated with a specific agent.
                            </div>
                            <div class="parameters">
                                <div class="parameter">
                                    <span class="parameter-name">agent_name</span>
                                    <span class="parameter-type">string</span>
                                    <span class="parameter-required">required</span>
                                    <div>Name of the agent to query</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3>Agent Unregistration <span class="status-badge status-new">New</span></h3>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <span class="endpoint-path">/api/agents/{agent_name}/unregister</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Safely unregister an agent by deleting its SSM parameters. Supports dry-run mode for
                                testing.
                            </div>
                            <h4>Request Body</h4>
                            <div class="code-block json">
                                {
                                "agent_name": "test-agent",
                                "dry_run": true,
                                "force": false
                                }
                            </div>
                            <div class="parameters">
                                <div class="parameter">
                                    <span class="parameter-name">dry_run</span>
                                    <span class="parameter-type">boolean</span>
                                    <span class="parameter-optional">optional</span>
                                    <div>If true, simulates the operation without making changes (default: false)</div>
                                </div>
                                <div class="parameter">
                                    <span class="parameter-name">force</span>
                                    <span class="parameter-type">boolean</span>
                                    <span class="parameter-optional">optional</span>
                                    <div>If true, continues operation even if some parameters fail to delete (default:
                                        false)</div>
                                </div>
                            </div>
                            <h4>Response</h4>
                            <div class="code-block json">
                                {
                                "status": "success",
                                "agent_name": "test-agent",
                                "agent_type": "strands_agent",
                                "parameters_deleted": [
                                "/coa/agents/test-agent/agent_arn",
                                "/coa/agents/test-agent/metadata"
                                ],
                                "parameters_failed": [],
                                "error_message": null,
                                "timestamp": "2024-01-01T12:00:00Z",
                                "summary": {
                                "total_parameters": 2,
                                "deleted_count": 2,
                                "failed_count": 0,
                                "success_rate": 1.0
                                }
                                }
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <span class="endpoint-path">/api/agents/unregister/bulk</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Unregister multiple agents in a single operation.
                            </div>
                            <h4>Request Body</h4>
                            <div class="code-block json">
                                {
                                "agent_names": ["agent1", "agent2", "agent3"],
                                "dry_run": true,
                                "force": false
                                }
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <span class="endpoint-path">/api/agents/cleanup/orphaned</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Clean up orphaned parameters that don't belong to any complete agent.
                            </div>
                            <div class="parameters">
                                <div class="parameter">
                                    <span class="parameter-name">dry_run</span>
                                    <span class="parameter-type">boolean</span>
                                    <span class="parameter-optional">query param</span>
                                    <div>Whether to simulate the cleanup (default: true)</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/api/agents/unregistration/health</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Check health status of the agent unregistration service.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Config API Tab -->
            <div id="config-api" class="tab-content">
                <div class="section">
                    <h2>‚öôÔ∏è Configuration API</h2>

                    <h3>Application Configuration</h3>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/api/config</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Get all application configuration (excluding sensitive values).
                            </div>
                            <h4>Response</h4>
                            <div class="code-block json">
                                {
                                "config": {
                                "ENHANCED_SECURITY_AGENT_ID": "MOCK123456",
                                "ENHANCED_SECURITY_AGENT_ALIAS_ID": "MOCK123456",
                                "AWS_DEFAULT_REGION": "us-east-1",
                                "BEDROCK_REGION": "us-east-1",
                                "AWS_SECRET_ACCESS_KEY": "***"
                                },
                                "ssm_status": {
                                "available": true,
                                "last_check": "2024-01-01T12:00:00Z",
                                "parameters_count": 15
                                }
                                }
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <span class="endpoint-path">/api/config/refresh</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Refresh configuration cache from SSM Parameter Store.
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/api/config/ssm/parameters</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                List all SSM parameters for this application.
                            </div>
                        </div>
                    </div>

                    <h3>AWS Configuration</h3>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/api/aws-config</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Get current AWS configuration including account ID, region, and role information.
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <span class="endpoint-path">/api/aws-config</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Update AWS configuration for cross-account access.
                            </div>
                            <h4>Request Body</h4>
                            <div class="code-block json">
                                {
                                "target_account_id": "123456789012",
                                "region": "us-east-1",
                                "aws_access_key_id": "optional-access-key",
                                "aws_secret_access_key": "optional-secret-key"
                                }
                            </div>
                        </div>
                    </div>

                    <h3>MCP Server Information</h3>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/api/mcp/status</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Get detailed MCP server status without authentication.
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/api/mcp/servers</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                List all available MCP servers integrated with the agent.
                            </div>
                            <h4>Response</h4>
                            <div class="code-block json">
                                {
                                "total_servers": 3,
                                "servers": [
                                {
                                "name": "wa_security_mcp",
                                "display_name": "WA Security MCP",
                                "agent_id": "security-agent-123",
                                "agent_arn":
                                "arn:aws:bedrock-agentcore:us-east-1:123456789012:runtime/security-agent-123",
                                "region": "us-east-1",
                                "deployment_type": "agentcore_runtime",
                                "capabilities": ["security_analysis", "compliance_check"],
                                "capabilities_count": 2,
                                "status": "deployed",
                                "framework": "agentcore_runtime"
                                }
                                ],
                                "timestamp": "2024-01-01T12:00:00Z",
                                "source": "ssm_parameter_store"
                                }
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/api/mcp/tools</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                List all available tools integrated with the agent, organized by server and category.
                            </div>
                            <h4>Response</h4>
                            <div class="code-block json">
                                {
                                "total_tools": 15,
                                "tools": [
                                {
                                "name": "CheckSecurityServices",
                                "description": "Verify AWS security services status",
                                "parameters": {...},
                                "server_name": "wa_security_mcp",
                                "server_display_name": "WA Security MCP",
                                "category": "security",
                                "status": "available"
                                }
                                ],
                                "tools_by_server": {...},
                                "tools_by_category": {...},
                                "servers_count": 3,
                                "categories_count": 4,
                                "timestamp": "2024-01-01T12:00:00Z"
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AgentCore API Tab -->
            <div id="agentcore-api" class="tab-content">
                <div class="section">
                    <h2>üîß AgentCore API</h2>

                    <h3>Agent Registry</h3>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/api/agentcore/agents</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Get all AgentCore agents from the registry with detailed information and statistics.
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <span class="endpoint-path">/api/agentcore/discover</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Manually trigger AgentCore agent discovery from SSM Parameter Store.
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/api/agentcore/status</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Get comprehensive AgentCore system status including registry, discovery, and invocation
                                services.
                            </div>
                            <h4>Response</h4>
                            <div class="code-block json">
                                {
                                "status": "success",
                                "overall_status": "healthy",
                                "services": {
                                "registry": {
                                "health": "healthy",
                                "stats": {
                                "total_agents": 3,
                                "healthy_agents": 2,
                                "cache_hits": 45,
                                "cache_misses": 3
                                }
                                },
                                "discovery": {
                                "health": "healthy",
                                "stats": {...},
                                "status": {
                                "running": true,
                                "interval": 300,
                                "last_scan": "2024-01-01T12:00:00Z"
                                }
                                },
                                "invocation": {
                                "health": "healthy",
                                "stats": {...}
                                }
                                }
                                }
                            </div>
                        </div>
                    </div>

                    <h3>Agent Invocation</h3>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <span class="endpoint-path">/api/agentcore/invoke/{agent_id}</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Directly invoke a specific AgentCore agent with a message.
                            </div>
                            <div class="parameters">
                                <div class="parameter">
                                    <span class="parameter-name">agent_id</span>
                                    <span class="parameter-type">string</span>
                                    <span class="parameter-required">required</span>
                                    <div>ID of the AgentCore agent to invoke</div>
                                </div>
                            </div>
                            <h4>Request Body</h4>
                            <div class="code-block json">
                                {
                                "message": "Check my security services status",
                                "session_id": "direct-invocation-123",
                                "context": {
                                "aws_account_id": "123456789012"
                                }
                                }
                            </div>
                        </div>
                    </div>

                    <h3>Discovery Management</h3>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/api/agentcore/discovery/status</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Get periodic discovery status and configuration.
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <span class="endpoint-path">/api/agentcore/discovery/start</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Start periodic discovery of AgentCore agents.
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <span class="endpoint-path">/api/agentcore/discovery/stop</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Stop periodic discovery of AgentCore agents.
                            </div>
                        </div>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <span class="endpoint-path">/api/agentcore/discovery/configure</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Configure periodic discovery settings including interval and enabled status.
                            </div>
                            <h4>Request Body</h4>
                            <div class="code-block json">
                                {
                                "interval": 600,
                                "enabled": true
                                }
                            </div>
                            <div class="parameters">
                                <div class="parameter">
                                    <span class="parameter-name">interval</span>
                                    <span class="parameter-type">integer</span>
                                    <span class="parameter-optional">optional</span>
                                    <div>Discovery interval in seconds (minimum: 30)</div>
                                </div>
                                <div class="parameter">
                                    <span class="parameter-name">enabled</span>
                                    <span class="parameter-type">boolean</span>
                                    <span class="parameter-optional">optional</span>
                                    <div>Whether to enable or disable periodic discovery</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3>System Health</h3>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <span class="endpoint-path">/health</span>
                        </div>
                        <div class="endpoint-body">
                            <div class="endpoint-description">
                                Comprehensive system health check including all services and components.
                            </div>
                            <h4>Response</h4>
                            <div class="code-block json">
                                {
                                "status": "healthy",
                                "services": {
                                "orchestrator": "healthy",
                                "auth": "healthy",
                                "bedrock_agents": "healthy",
                                "agentcore_registry": "healthy",
                                "agentcore_discovery": "healthy",
                                "agentcore_invocation": "healthy",
                                "agentcore_commands": "healthy",
                                "agentcore_unregistration": "healthy"
                                },
                                "timestamp": "2024-01-01T12:00:00Z"
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cross-Account Operations Tab -->
            <div id="cross-account" class="tab-content">
                <div class="section">
                    <h2>üîó Cross-Account Operations</h2>
                    <p>The Cloud Optimization Assistant supports secure cross-account operations through AWS IAM AssumeRole functionality. This enables agents and MCP servers to access resources in target AWS accounts while maintaining strict security controls and least-privilege access.</p>

                    <div class="feature-card" style="margin: 30px 0; background: #e8f4fd; border-left: 5px solid #3498db;">
                        <h4>üîê Security Architecture</h4>
                        <p><strong>Secure cross-account access through IAM role assumption.</strong> The AgentCore runtime assumes read-only roles in target accounts, enabling comprehensive security auditing and analysis without compromising account security.</p>
                        <ul class="feature-list">
                            <li>Temporary credential-based access (no long-term keys)</li>
                            <li>External ID validation for enhanced security</li>
                            <li>Read-only permissions with least-privilege principle</li>
                            <li>Audit trail through CloudTrail logging</li>
                        </ul>
                    </div>

                    <h3>üèóÔ∏è Architecture Overview</h3>
                    <div class="architecture-diagram">
                        <pre style="text-align: left; font-family: monospace; color: #2c3e50;">

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                           COA Platform Account                                  ‚îÇ
‚îÇ                                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   Web Frontend  ‚îÇ    ‚îÇ  FastAPI Backend‚îÇ    ‚îÇ     AgentCore Runtime        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                 ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ                 ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ  ‚îÇ  Strands Agents         ‚îÇ ‚îÇ ‚îÇ
‚îÇ                                                ‚îÇ  ‚îÇ  ‚Ä¢ strands-aws-api      ‚îÇ ‚îÇ ‚îÇ
‚îÇ                                                ‚îÇ  ‚îÇ  ‚Ä¢ strands-wa-sec       ‚îÇ ‚îÇ ‚îÇ
‚îÇ                                                ‚îÇ  ‚îÇ  ‚Ä¢ strands-cost-opt     ‚îÇ ‚îÇ ‚îÇ
‚îÇ                                                ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ
‚îÇ                                                ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ
‚îÇ                                                ‚îÇ  ‚îÇ  MCP Servers            ‚îÇ ‚îÇ ‚îÇ
‚îÇ                                                ‚îÇ  ‚îÇ  ‚Ä¢ AWS API MCP          ‚îÇ ‚îÇ ‚îÇ
‚îÇ                                                ‚îÇ  ‚îÇ  ‚Ä¢ WA Security MCP      ‚îÇ ‚îÇ ‚îÇ
‚îÇ                                                ‚îÇ  ‚îÇ  ‚Ä¢ Cost Management MCP  ‚îÇ ‚îÇ ‚îÇ
‚îÇ                                                ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ
‚îÇ                                                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                        ‚îÇ
                                        ‚îÇ AssumeRole
                                        ‚îÇ (with External ID)
                                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                            Target AWS Account                                   ‚îÇ
‚îÇ                                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ                    COAReadOnlyRole                                      ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                                                         ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  Permissions:                                                           ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ SecurityAudit (AWS Managed Policy)                                   ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ ReadOnlyAccess (AWS Managed Policy)                                  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Custom policies for specific services                                ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                                                         ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  Trust Policy:                                                          ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Principal: COA Platform Account Role                                 ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Condition: ExternalId validation                                     ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ MFA: Optional (recommended for production)                           ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   EC2 Instances ‚îÇ  ‚îÇ   S3 Buckets    ‚îÇ  ‚îÇ      Security Services          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   RDS Databases ‚îÇ  ‚îÇ   IAM Resources ‚îÇ  ‚îÇ   ‚Ä¢ GuardDuty                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   Lambda Funcs  ‚îÇ  ‚îÇ   VPC Resources ‚îÇ  ‚îÇ   ‚Ä¢ Security Hub                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   EBS Volumes   ‚îÇ  ‚îÇ   CloudTrail    ‚îÇ  ‚îÇ   ‚Ä¢ Inspector                   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

                        </pre>
                    </div>

                    <h3>üîë IAM Permission Control</h3>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>üéØ AgentCore Runtime Role</h4>
                            <p>The AgentCore runtime executes with an IAM role that has permissions to assume roles in target accounts:</p>
                            <ul class="feature-list">
                                <li><strong>sts:AssumeRole</strong> - Assume cross-account roles</li>
                                <li><strong>sts:TagSession</strong> - Tag assumed role sessions</li>
                                <li><strong>ssm:GetParameter*</strong> - Access configuration parameters</li>
                                <li><strong>bedrock:InvokeModel</strong> - Access AI models</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <h4>üõ°Ô∏è Target Account Role</h4>
                            <p>Read-only role in target accounts with comprehensive audit permissions:</p>
                            <ul class="feature-list">
                                <li><strong>SecurityAudit</strong> - AWS managed security audit policy</li>
                                <li><strong>ReadOnlyAccess</strong> - AWS managed read-only policy</li>
                                <li><strong>Custom policies</strong> - Service-specific read permissions</li>
                                <li><strong>External ID</strong> - Enhanced security validation</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <h4>üîê Security Controls</h4>
                            <p>Multiple layers of security ensure safe cross-account access:</p>
                            <ul class="feature-list">
                                <li><strong>Temporary credentials</strong> - Short-lived access tokens</li>
                                <li><strong>External ID validation</strong> - Prevents confused deputy attacks</li>
                                <li><strong>Session tagging</strong> - Audit trail and attribution</li>
                                <li><strong>Least privilege</strong> - Minimal required permissions</li>
                            </ul>
                        </div>
                    </div>

                    <h3>‚öôÔ∏è Configuration Parameters</h3>
                    <p>Cross-account operations are configured through environment variables and context parameters:</p>

                    <div class="parameters">
                        <div class="parameter">
                            <span class="parameter-name">role_arn</span>
                            <span class="parameter-type">string</span>
                            <span class="parameter-optional">optional</span>
                            <div>Complete ARN of the role to assume: <code>arn:aws:iam::ACCOUNT-ID:role/ROLE-NAME</code></div>
                        </div>
                        <div class="parameter">
                            <span class="parameter-name">account_id</span>
                            <span class="parameter-type">string</span>
                            <span class="parameter-optional">optional</span>
                            <div>12-digit AWS account ID. Will construct role ARN as: <code>arn:aws:iam::ACCOUNT-ID:role/COAReadOnlyRole</code></div>
                        </div>
                        <div class="parameter">
                            <span class="parameter-name">external_id</span>
                            <span class="parameter-type">string</span>
                            <span class="parameter-optional">optional</span>
                            <div>External ID for enhanced security when assuming roles (recommended for production)</div>
                        </div>
                        <div class="parameter">
                            <span class="parameter-name">session_name</span>
                            <span class="parameter-type">string</span>
                            <span class="parameter-optional">optional</span>
                            <div>Session name for the assumed role (defaults to agent-specific names)</div>
                        </div>
                    </div>

                    <h3>üîß Implementation Details</h3>

                    <h4>Environment Variables</h4>
                    <p>The MCP servers and agents use these environment variables for cross-account access:</p>
                    <div class="code-block bash">
# Cross-account role configuration
AWS_ASSUME_ROLE_ARN="arn:aws:iam::123456789012:role/COAReadOnlyRole"
AWS_ASSUME_ROLE_SESSION_NAME="coa-security-assessment"
AWS_ASSUME_ROLE_EXTERNAL_ID="unique-external-id-123"

# Standard AWS configuration
AWS_REGION="us-east-1"
AWS_DEFAULT_REGION="us-east-1"
                    </div>

                    <h4>Parameter Precedence</h4>
                    <p>When both <code>role_arn</code> and <code>account_id</code> are provided:</p>
                    <ul class="feature-list">
                        <li><strong>role_arn takes precedence</strong> - Uses the exact ARN provided</li>
                        <li><strong>account_id is ignored</strong> - Logs a warning about the override</li>
                        <li><strong>Validation occurs</strong> - ARN format is validated before use</li>
                    </ul>

                    <h4>Credential Chain</h4>
                    <p>The system follows this credential resolution order:</p>
                    <ol style="padding-left: 20px;">
                        <li><strong>AssumeRole credentials</strong> - If cross-account parameters are configured</li>
                        <li><strong>Environment variables</strong> - AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY</li>
                        <li><strong>AWS Profile</strong> - From AWS_PROFILE environment variable</li>
                        <li><strong>Instance profile</strong> - For EC2/ECS/Lambda execution</li>
                        <li><strong>Default profile</strong> - From ~/.aws/credentials</li>
                    </ol>

                    <h3>üõ°Ô∏è Security Assessment Example</h3>
                    <p>Here's a practical example of using cross-account operations for security assessment:</p>

                    <h4>1. Deploy Read-Only Role in Target Account</h4>
                    <div class="code-block json"><pre>
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::COA-PLATFORM-ACCOUNT:role/AgentCoreRuntimeRole"
      },
      "Action": "sts:AssumeRole",
      "Condition": {
        "StringEquals": {
          "sts:ExternalId": "unique-external-id-123"
        }
      }
    }
  ]
}
                    </pre></div>

                    <h4>2. Configure Cross-Account Access</h4>
                    <div class="code-block bash">
# In the COA platform, configure the target account
curl -X POST "http://localhost:8001/api/chat" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your-jwt-token" \
  -d '{
    "message": "Assess security for account 123456789012 with external ID abc123",
    "context": {
      "account_id": "123456789012",
      "external_id": "abc123",
      "session_name": "security-assessment"
    }
  }'
                    </div>

                    <h4>3. Security Assessment Execution</h4>
                    <p>The system will automatically:</p>
                    <ul class="feature-list">
                        <li><strong>Assume the target role</strong> using the provided credentials</li>
                        <li><strong>Execute security tools</strong> like CheckSecurityServices, GetSecurityFindings</li>
                        <li><strong>Gather security data</strong> from GuardDuty, Security Hub, Inspector, etc.</li>
                        <li><strong>Generate recommendations</strong> based on Well-Architected Security Pillar</li>
                        <li><strong>Return structured results</strong> with actionable insights</li>
                    </ul>

                    <h4>4. Example Security Assessment Response</h4>
                    <div class="code-block json">
                        <pre>
{
  "response": "# Cross-Account Security Assessment Complete\n\n## Target Account: 123456789012\n\n### Security Services Status\n- ‚úÖ **GuardDuty**: Enabled with 45 findings\n- ‚úÖ **Security Hub**: Enabled with compliance scores\n- ‚ùå **Inspector**: Not enabled (recommendation: enable)\n- ‚úÖ **CloudTrail**: Enabled with proper configuration\n\n### Key Findings\n1. **HIGH**: 3 critical GuardDuty findings require attention\n2. **MEDIUM**: 12 security groups with overly permissive rules\n3. **LOW**: 8 S3 buckets without encryption\n\n### Recommendations\n1. Enable Inspector for vulnerability assessments\n2. Remediate critical GuardDuty findings\n3. Implement S3 bucket encryption policies",
  "structured_data": {
    "account_id": "123456789012",
    "assessment_type": "cross_account_security",
    "services_checked": ["guardduty", "securityhub", "inspector", "cloudtrail"],
    "findings_summary": {
      "critical": 3,
      "high": 8,
      "medium": 12,
      "low": 8
    },
    "compliance_score": 78
  },
  "tool_executions": [
    {
      "tool_name": "CheckSecurityServices",
      "status": "success",
      "cross_account": true,
      "target_account": "123456789012"
    }
  ]
}
                        </pre>
                    </div>

                    <h3>üöÄ Quick Start Guide</h3>

                    <h4>Step 1: Deploy Cross-Account Role</h4>
                    <p>Use the provided CloudFormation template to deploy the read-only role:</p>
                    <div class="code-block bash">
# Deploy the COA read-only role in your target account
aws cloudformation create-stack \
  --stack-name coa-readonly-role \
  --template-url https://workshop-data-public.s3.ap-northeast-1.amazonaws.com/remote-role-mcpreadonlyall-20250831_134154.yaml \
  --parameters ParameterKey=ExternalId,ParameterValue=your-unique-external-id \
               ParameterKey=TrustedAccount,ParameterValue=COA-PLATFORM-ACCOUNT-ID \
  --capabilities CAPABILITY_IAM
                    </div>

                    <h4>Step 2: Test Cross-Account Access</h4>
                    <div class="code-block bash">
# Test the cross-account configuration
curl -X POST "http://localhost:8001/api/chat" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your-jwt-token" \
  -d '{
    "message": "Validate cross-account access for account 123456789012",
    "context": {
      "account_id": "123456789012",
      "external_id": "your-unique-external-id"
    }
  }'
                    </div>

                    <h4>Step 3: Run Security Assessment</h4>
                    <div class="code-block bash">
# Execute comprehensive security assessment
curl -X POST "http://localhost:8001/api/chat" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your-jwt-token" \
  -d '{
    "message": "Perform comprehensive security assessment including GuardDuty findings, Security Hub compliance, and storage encryption analysis",
    "context": {
      "account_id": "123456789012",
      "external_id": "your-unique-external-id",
      "assessment_type": "comprehensive"
    }
  }'
                    </div>

                    <h3>üîç Troubleshooting</h3>

                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>‚ùå AssumeRole Failures</h4>
                            <p>Common issues and solutions:</p>
                            <ul class="feature-list">
                                <li><strong>Invalid ARN format</strong> - Verify role ARN syntax</li>
                                <li><strong>Trust policy mismatch</strong> - Check principal and external ID</li>
                                <li><strong>Permission denied</strong> - Verify sts:AssumeRole permissions</li>
                                <li><strong>External ID mismatch</strong> - Ensure external IDs match exactly</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <h4>üîê Permission Issues</h4>
                            <p>Access denied troubleshooting:</p>
                            <ul class="feature-list">
                                <li><strong>Missing policies</strong> - Attach SecurityAudit and ReadOnlyAccess</li>
                                <li><strong>Service-specific permissions</strong> - Add custom policies as needed</li>
                                <li><strong>Resource-level restrictions</strong> - Check resource-based policies</li>
                                <li><strong>Condition failures</strong> - Verify condition keys and values</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <h4>üîß Configuration Issues</h4>
                            <p>Setup and configuration problems:</p>
                            <ul class="feature-list">
                                <li><strong>Environment variables</strong> - Verify AWS_ASSUME_ROLE_* settings</li>
                                <li><strong>Parameter precedence</strong> - Check role_arn vs account_id usage</li>
                                <li><strong>Session naming</strong> - Ensure valid session name format</li>
                                <li><strong>Region consistency</strong> - Match regions across accounts</li>
                            </ul>
                        </div>
                    </div>

                    <h3>üìä Best Practices</h3>

                    <div class="feature-card" style="background: #f0f8f0; border-left: 5px solid #27ae60;">
                        <h4>‚úÖ Security Best Practices</h4>
                        <ul class="feature-list">
                            <li><strong>Use External IDs</strong> - Always configure external IDs for production</li>
                            <li><strong>Rotate External IDs</strong> - Regularly update external IDs</li>
                            <li><strong>Monitor AssumeRole</strong> - Set up CloudTrail alerts for role assumptions</li>
                            <li><strong>Least Privilege</strong> - Grant only necessary permissions</li>
                            <li><strong>Session Tagging</strong> - Use descriptive session names for audit trails</li>
                            <li><strong>Time Limits</strong> - Configure appropriate session duration limits</li>
                        </ul>
                    </div>

                    <div class="feature-card" style="background: #fff8e1; border-left: 5px solid #ff9800;">
                        <h4>‚ö° Performance Best Practices</h4>
                        <ul class="feature-list">
                            <li><strong>Credential Caching</strong> - Cache assumed role credentials appropriately</li>
                            <li><strong>Parallel Operations</strong> - Use concurrent API calls when possible</li>
                            <li><strong>Regional Optimization</strong> - Execute operations in target account regions</li>
                            <li><strong>Batch Operations</strong> - Group related API calls together</li>
                            <li><strong>Error Handling</strong> - Implement proper retry logic with exponential backoff</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Examples Tab -->
            <div id="examples" class="tab-content">
                <div class="section">
                    <h2>üìù Usage Examples</h2>

                    <h3>üöÄ Getting Started</h3>

                    <h4>1. Check System Health</h4>
                    <div class="code-block bash">
                        curl -X GET "http://localhost:8001/health"
                    </div>

                    <h4>2. List Available Agents</h4>
                    <div class="code-block bash">
                        curl -X GET "http://localhost:8001/api/agents/status"
                    </div>

                    <h4>3. Send a Chat Message</h4>
                    <div class="code-block bash">
                        curl -X POST "http://localhost:8001/api/chat/local" \
                        -H "Content-Type: application/json" \
                        -d '{
                        "message": "What is my AWS security posture?",
                        "session_id": "test-session-123"
                        }'
                    </div>

                    <h3>üí¨ Chat Examples</h3>

                    <h4>Security Analysis</h4>
                    <div class="code-block bash">
                        curl -X POST "http://localhost:8001/api/chat" \
                        -H "Content-Type: application/json" \
                        -H "Authorization: Bearer your-jwt-token" \
                        -d '{
                        "message": "Check my security services and provide recommendations",
                        "context": {
                        "aws_account_id": "123456789012"
                        }
                        }'
                    </div>

                    <h4>Cost Optimization</h4>
                    <div class="code-block bash">
                        curl -X POST "http://localhost:8001/api/chat" \
                        -H "Content-Type: application/json" \
                        -H "Authorization: Bearer your-jwt-token" \
                        -d '{
                        "message": "I want to check my cost spending and optimization opportunities",
                        "context": {
                        "aws_account_id": "123456789012"
                        }
                        }'
                    </div>

                    <h4>WebSocket Connection (JavaScript)</h4>
                    <div class="code-block json">
                        const ws = new WebSocket('ws://localhost:8001/ws/my-session-123');

                        ws.onopen = function() {
                        console.log('Connected to chat');

                        // Send a message
                        ws.send(JSON.stringify({
                        message: "Analyze my AWS infrastructure",
                        context: {
                        aws_account_id: "123456789012"
                        }
                        }));
                        };

                        ws.onmessage = function(event) {
                        const data = JSON.parse(event.data);
                        console.log('Received:', data);
                        };
                    </div>

                    <h3>ü§ñ Agent Management Examples</h3>

                    <h4>List All Registered Agents</h4>
                    <div class="code-block bash">
                        curl -X GET "http://localhost:8001/api/agents/registered" \
                        -H "Authorization: Bearer your-jwt-token"
                    </div>

                    <h4>View Agent Parameters</h4>
                    <div class="code-block bash">
                        curl -X GET "http://localhost:8001/api/agents/strands_aws_wa_sec_cost/parameters" \
                        -H "Authorization: Bearer your-jwt-token"
                    </div>

                    <h4>Dry Run Agent Unregistration</h4>
                    <div class="code-block bash">
                        curl -X POST "http://localhost:8001/api/agents/test-agent/unregister" \
                        -H "Content-Type: application/json" \
                        -H "Authorization: Bearer your-jwt-token" \
                        -d '{
                        "agent_name": "test-agent",
                        "dry_run": true,
                        "force": false
                        }'
                    </div>

                    <h4>Actual Agent Unregistration</h4>
                    <div class="code-block bash">
                        curl -X POST "http://localhost:8001/api/agents/test-agent/unregister" \
                        -H "Content-Type: application/json" \
                        -H "Authorization: Bearer your-jwt-token" \
                        -d '{
                        "agent_name": "test-agent",
                        "dry_run": false,
                        "force": true
                        }'
                    </div>

                    <h4>Bulk Agent Unregistration</h4>
                    <div class="code-block bash">
                        curl -X POST "http://localhost:8001/api/agents/unregister/bulk" \
                        -H "Content-Type: application/json" \
                        -H "Authorization: Bearer your-jwt-token" \
                        -d '{
                        "agent_names": ["agent1", "agent2", "agent3"],
                        "dry_run": true,
                        "force": false
                        }'
                    </div>

                    <h4>Cleanup Orphaned Parameters</h4>
                    <div class="code-block bash">
                        # Dry run first
                        curl -X POST "http://localhost:8001/api/agents/cleanup/orphaned?dry_run=true" \
                        -H "Authorization: Bearer your-jwt-token"

                        # Execute cleanup
                        curl -X POST "http://localhost:8001/api/agents/cleanup/orphaned?dry_run=false" \
                        -H "Authorization: Bearer your-jwt-token"
                    </div>

                    <h3>‚öôÔ∏è Configuration Examples</h3>

                    <h4>Get Current Configuration</h4>
                    <div class="code-block bash">
                        curl -X GET "http://localhost:8001/api/config" \
                        -H "Authorization: Bearer your-jwt-token"
                    </div>

                    <h4>Refresh Configuration Cache</h4>
                    <div class="code-block bash">
                        curl -X POST "http://localhost:8001/api/config/refresh" \
                        -H "Authorization: Bearer your-jwt-token"
                    </div>

                    <h4>Update AWS Configuration</h4>
                    <div class="code-block bash">
                        curl -X POST "http://localhost:8001/api/aws-config" \
                        -H "Content-Type: application/json" \
                        -H "Authorization: Bearer your-jwt-token" \
                        -d '{
                        "target_account_id": "123456789012",
                        "region": "us-west-2"
                        }'
                    </div>

                    <h3>üîß AgentCore Examples</h3>

                    <h4>Trigger Agent Discovery</h4>
                    <div class="code-block bash">
                        curl -X POST "http://localhost:8001/api/agentcore/discover" \
                        -H "Authorization: Bearer your-jwt-token"
                    </div>

                    <h4>Get AgentCore Status</h4>
                    <div class="code-block bash">
                        curl -X GET "http://localhost:8001/api/agentcore/status" \
                        -H "Authorization: Bearer your-jwt-token"
                    </div>

                    <h4>Configure Periodic Discovery</h4>
                    <div class="code-block bash">
                        curl -X POST "http://localhost:8001/api/agentcore/discovery/configure" \
                        -H "Content-Type: application/json" \
                        -H "Authorization: Bearer your-jwt-token" \
                        -d '{
                        "interval": 600,
                        "enabled": true
                        }'
                    </div>

                    <h4>Direct Agent Invocation</h4>
                    <div class="code-block bash">
                        curl -X POST "http://localhost:8001/api/agentcore/invoke/AGENT123456" \
                        -H "Content-Type: application/json" \
                        -H "Authorization: Bearer your-jwt-token" \
                        -d '{
                        "message": "Check security services status",
                        "session_id": "direct-test-123"
                        }'
                    </div>

                    <h3>üîê Authentication Examples</h3>

                    <h4>Using JWT Token</h4>
                    <div class="code-block bash">
                        # Get token from Cognito (example)
                        TOKEN="eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."

                        # Use token in requests
                        curl -X GET "http://localhost:8001/api/agents" \
                        -H "Authorization: Bearer $TOKEN"
                    </div>

                    <h4>Local Testing (No Auth)</h4>
                    <div class="code-block bash">
                        # Use local endpoints for testing without authentication
                        curl -X POST "http://localhost:8001/api/chat/local" \
                        -H "Content-Type: application/json" \
                        -d '{
                        "message": "Test message without authentication"
                        }'
                    </div>

                    <h3>üìä Monitoring Examples</h3>

                    <h4>Health Check Script</h4>
                    <div class="code-block bash">
                        #!/bin/bash
                        # health-check.sh

                        BASE_URL="http://localhost:8001"

                        echo "Checking system health..."
                        curl -s "$BASE_URL/health" | jq '.status'

                        echo "Checking agent status..."
                        curl -s "$BASE_URL/api/agents/status" | jq '.total_agents'

                        echo "Checking AgentCore status..."
                        curl -s "$BASE_URL/api/agentcore/status" | jq '.overall_status'
                    </div>

                    <h4>Agent Monitoring Script</h4>
                    <div class="code-block bash">
                        #!/bin/bash
                        # monitor-agents.sh

                        TOKEN="your-jwt-token"
                        BASE_URL="http://localhost:8001"

                        # Get all registered agents
                        echo "Registered Agents:"
                        curl -s -H "Authorization: Bearer $TOKEN" \
                        "$BASE_URL/api/agents/registered" | \
                        jq -r '.agents | keys[]'

                        # Check unregistration service health
                        echo "Unregistration Service Health:"
                        curl -s "$BASE_URL/api/agents/unregistration/health" | \
                        jq '.service_health'
                    </div>

                    <h3>üö® Error Handling Examples</h3>

                    <h4>Handling API Errors</h4>
                    <div class="code-block json">
                        // Example error response
                        {
                        "detail": "Agent 'non-existent-agent' not found",
                        "status_code": 404,
                        "timestamp": "2024-01-01T12:00:00Z"
                        }

                        // JavaScript error handling
                        fetch('/api/agents/non-existent-agent/parameters')
                        .then(response => {
                        if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        return response.json();
                        })
                        .catch(error => {
                        console.error('API Error:', error.message);
                        });
                    </div>

                    <h4>Retry Logic Example</h4>
                    <div class="code-block json">
                        // JavaScript retry logic
                        async function apiCallWithRetry(url, options, maxRetries = 3) {
                        for (let i = 0; i < maxRetries; i++) { try { const response=await fetch(url, options); if
                            (response.ok) { return await response.json(); } if (response.status < 500) { // Client
                            error, don't retry throw new Error(`HTTP ${response.status}: ${response.statusText}`); } }
                            catch (error) { if (i===maxRetries - 1) throw error; await new Promise(resolve=>
                            setTimeout(resolve, 1000 * (i + 1)));
                            }
                            }
                            }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });

            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab content
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function () {
            // Set up syntax highlighting for code blocks (if needed)
            console.log('Backend API Documentation loaded');
        });
    </script>
</body>

</html>